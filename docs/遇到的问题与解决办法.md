## 这是一个示例问题

这是一个示例解决办法。

注：多个问题之间需要使用分隔线进行分隔。

---

## Connexion 3.x 在 ASGI 模式下 `request.get_json()` 报错

**问题描述**：
在使用 `uvicorn` 启动 Connexion 应用时，`connexion.request` 是 Starlette 请求对象的代理。由于 Starlette 的请求处理是异步 的，它不支持 Flask 风格的同步 `get_json()` 方法。直接调用会导致 `AttributeError: 'Request' object has no attribute 'get_json'`，从而触发 500 错误。

**解决办法**：
遵循 Connexion 的最佳实践，放弃手动调用 `request.get_json()`，改为使用**参数注入（Parameter Injection）**。

1. 在 OpenAPI 规范中定义好 `requestBody`。
2. 在对应的 Python 处理函数签名中添加 `body` 参数（或规范中定义的具体参数名）。
3. Connexion 框架会自动解析请求体并将其作为参数传递给函数。

例如：

```python
# 修改前
def login():
    payload = request.get_json()

# 修改后
def login(body):
    payload = body
```

对于 `multipart/form-data` 上传，同样可以使用参数注入直接获取 `file` 和其他表单字段。

---

## 单图编辑无预览接口导致前端只能提交后查看结果

**问题描述**：
- 只有裁剪/色调的落盘接口，前端无法在参数变动时获取编辑后的效果图，用户容易误解或误操作。

**解决办法**：
1. 在 `backend/src/api/images.py` 新增 `preview_edit`，沿用裁剪/色调的参数校验与权限校验，返回内存生成的 `image/png`。
2. 在 `backend/src/utils/image_ops.py` 抽出 `_apply_crop/_apply_hue` 并提供 `build_edit_preview`，避免落盘即可生成预览。
3. 前端调用 `/api/images/{id}/edit/preview`，等待时用计算尺寸的占位+转圈提示，结果返回后替换为预览图。
