# 图片管理网站

## 实验要求

需要实现的基本功能如下:

- 实现用户注册、登录功能,用户注册时需要填写必要的信息并验证,如用户名、密码要求在 6 字节以上, email 的格式验证, 并保证用户名和 email 在系统中唯一, 用户登录后可以进行以下操作。
    - 在初始化项目时默认分配管理员账户admin，管理员密码123456。用户有三种，一种是注册但是等待验证的用户（这种用户没有任何权限），一种是普通用户，一种是管理员。管理员可以审批验证用户的注册请求，并可以将普通用户设置为管理员，将管理员降级为普通用户，普通用户可以上传图片。
- 通过 PC 或手机浏览器将照片或其他类型的图片上传到网站进行存储。
    - 本项目应该将图片的原始文件保存在本地目录下，遵循格式/path/to/folder/{year}/{month}/{day}/{hash}.{ext}。这里的hash是随机的8位字符串，包含随机的字符或者数字。ext遵循图片上传时的原始文件名。
    - 管理员可以在后台配置允许上传哪些后缀的图片，这是一个string类型的配置项，多个允许的类型之间用英文逗号隔开，默认为jpg,png,gif,jpeg
    - 这些配置项通过一个项目根目录下的config.yaml进行配置，后续可以开发相应的前后端管理界面来实现对这个config的配置和热重载，但是总之这个配置不应该被保存到数据库中。
- 能够通过照片的 exif 信息自动创建图片分类标签及其他辅助信息,如时间、地点、图片分辨率等。
    - 图片的exif信息、时间、地点、图片的宽、图片的高等信息都应该分开创建数据库条目
- 可以给图片增加自定义分类标签,方便检索。
    - 这个也是一个数据库条目并且是list
    - 前端应该设计一个检索功能，用来浏览所有的图片，使用分页的形式进行加载，一页最多展示20张图片（作为一个配置项可进行配置）。也可以在检索时指定分类标签，这样的话就需要
- 生成缩略图方便后续显示。
    - 缩略图应该保存到数据库中，以base64编码的形式保存。缩略图应该通过mysql的形式进行提供。
- 图片信息保存在数据库中,方便后续查询。
    - 应该使用orm系统连接数据库，需要同时支持连接mysql数据库和sqlite数据库，默认连接到sqlite数据库。
    - 数据库中主要有以下几张表格：图片（记录每一张图片的信息）、用户（记录用户的相关信息、权限等）。
- 提供查询界面能根据各种条件查找图片。 具体要求就像前面说的。
- 对选定的图片提供简单的编辑功能,如裁剪、修改色调等 需要为每个图片有一个单独的浏览页面，同时在这个页面中提供各种编辑工鞥，比如裁剪、修改色调。具体来说可以提供一些表单，通过点击按钮打开，随后用户提交一些用户键入的信息，并交给后端直接修改磁盘上的原始图片，然后删除数据库中的缩略图，最后完成后返回给前端重新请求图片。
    - 裁剪功能：传回上下左右分别需要裁剪的比例，默认都为0%。 修改色调：提供一个slider以拖动，控制需要调整的色调。
    - 为了避免误删除，需要将编辑前的图片备份到/path/to/folder/backup/{year}/{month}/{day}/{hash}_{timestamp}.{ext}目录下，其中timestamp是编辑操作发生的时间；编辑后的图片会替换原路径中原来的图片。
- 提供删除功能 提交以后会将该图片从数据库中标记为删除，但这个图片还会在磁盘中保留。并且图片只是在数据库中被标记为删除，相关信息并不会被删除。之后可以在数据库中恢复。
- 样式适配手机, 开发手机 App 或能够在手机浏览器/微信等应用内置的浏览器中友好显示。
- 增强功能（暂时都不需要实现，但请预留好接口）:
    1. 调用 AI 模型分析图片,自动生成多类型的标签,如风景、人物、动物等，并添加到我们前面所支持的标签部分中。
    2. 提供 mcp 接口,能通过大模型对话方式检索网站上的图片。

## 框架设计

- 使用前后端分离架构，前后端之间的交互使用基于openapi格式的接口文件作为标准规范。
- 后端使用 Python + connexion 框架实现。使用 orm 库来访问 sqlite 数据库，图片的原始文件保存在本地录制下，该路径在 config.yml 中进行配置。config.yml 保存在项目的根目录下。
- 前端使用 React + @mui/material 框架实现，使用 material design 设计，自适应布局，同时还支持手机端和电脑端。

## 界面设计

前端主要包含以下几个界面：

1. 注册界面
2. 登录界面
3. 上传图片 界面，这个界面中可以上传图片。可以点击后通过浏览器对话框选择，也可以用户把图片拖入浏览器中上传。可以一次性上传多张图片，但是会一张一张分别上传（他们之间可以并行）。需要显示上传进度条。并且在上传完成后提供“一键复制图片链接”的按钮。
4. 浏览图片界面，这个页面可以按照时间顺序从新到旧查看所有图片，并且使用瀑布流形式加载：每张图片卡片固定高度为 200px，每次加载 20张图片，当滚动到底部的时候自动加载新的图片。这里图片显示时都需要使用缩略图。考虑到加载时间可能较长，未加载出来时需要显示 placeholder。
5. 设置页面，包含用户设置和全站设置。用户设置中可以修改密码（不能修改用户名）。全站设置只有管理员可以更改，包括：站点名称，站点favicon。